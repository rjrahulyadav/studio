rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // --- Rules for Training Modules ---
    // Anyone can view the list of training modules.
    // Only the admin can create, update, or delete them.
    match /trainingModules/{trainingModuleId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == '9Vl6oTot93b9TH442xYCDLbMLs32';
    }

    // --- Rules for creating an Applicant document ---
    // A user can create their own application.
    match /trainingModules/{trainingModuleId}/applicants/{applicantId} {
      allow create: if request.auth != null;
      
      // Explicitly deny updates and deletes from clients to prevent modification.
      allow update, delete: if false;
    }

    // --- Rule for Applicants Collection Group Query ---
    // This rule allows the administrator to read all documents in the 'applicants'
    // collection group, which is necessary for the admin dashboard.
    match /{path=**}/applicants/{applicantId} {
      allow read: if request.auth != null && request.auth.uid == '9Vl6oTot93b9TH442xYCDLbMLs32';
    }
  }
}
